<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduSphere | JEE/NEET Mock Test Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #059669;
            --accent: #d97706;
            --danger: #dc2626;
            --dark: #0f172a;
            --light: #f8fafc;
            --gradient: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
            --glass: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.12);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: var(--light);
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Auth Styles */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2.5rem;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--shadow);
        }

        .logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .logo-text {
            font-size: 2rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--light);
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            color: var(--light);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.1);
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        /* Dashboard Styles */
        .dashboard {
            display: none;
        }

        .header {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 1rem 1.5rem;
            background: transparent;
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            color: var(--light);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .nav-tab.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--light);
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .test-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1.5rem;
            transition: var(--transition);
            cursor: pointer;
        }

        .test-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .test-badge {
            background: var(--accent);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 1rem;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        /* Test Creation Styles */
        .test-creation-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .form-row {
            grid-column: 1 / -1;
        }

        .difficulty-selector {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .difficulty-option {
            flex: 1;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .difficulty-option.selected {
            background: var(--primary);
            border-color: var(--primary);
        }

        .difficulty-option:hover {
            border-color: var(--primary);
        }

        .question-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 1rem;
        }

        .question-item {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .question-text {
            flex: 1;
            margin-right: 1rem;
        }

        .question-difficulty {
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .difficulty-easy {
            background: var(--secondary);
        }

        .difficulty-medium {
            background: var(--accent);
        }

        .difficulty-hard {
            background: var(--danger);
        }

        /* Test Interface Styles */
        .test-interface {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark);
            z-index: 1000;
            overflow-y: auto;
            padding: 2rem;
        }

        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .test-timer {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        .question-container {
            margin-bottom: 2rem;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .options-container {
            display: grid;
            gap: 1rem;
        }

        .option {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .option:hover {
            border-color: var(--primary);
        }

        .option.selected {
            background: var(--primary);
            border-color: var(--primary);
        }

        .test-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        .question-palette {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .palette-item {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .palette-item.answered {
            background: var(--secondary);
        }

        .palette-item.current {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent);
        }

        /* AI Guidance Styles */
        .guidance-result {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .guidance-topic {
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .guidance-content {
            line-height: 1.6;
        }

        .guidance-content ul {
            margin-left: 1.5rem;
            margin-top: 0.5rem;
        }

        .guidance-content li {
            margin-bottom: 0.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* Performance Chart */
        .performance-chart {
            height: 300px;
            margin-top: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1rem;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
        }

        .chart-bar {
            width: 40px;
            background: var(--gradient);
            border-radius: 4px 4px 0 0;
            transition: var(--transition);
            position: relative;
        }

        .chart-bar:hover {
            transform: scale(1.05);
        }

        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .test-creation-form {
                grid-template-columns: 1fr;
            }

            .question-palette {
                grid-template-columns: repeat(5, 1fr);
            }

            .difficulty-selector {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Section -->
    <div class="auth-container" id="authContainer">
        <div class="auth-card">
            <!-- Login Form -->
            <div id="loginSection">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="logo-text">EduSphere</div>
                    <p style="opacity: 0.8; margin-top: 0.5rem;">JEE/NEET Mock Test Platform</p>
                </div>
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-input" id="username" placeholder="Enter your username" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="password" placeholder="Enter your password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Role</label>
                        <select class="form-input" id="role">
                            <option value="student">Student</option>
                            <option value="teacher">Teacher</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" id="loginBtn" style="width: 100%;">
                        <span>Sign In</span>
                    </button>
                </form>
                <div style="text-align: center; margin-top: 1.5rem; color: rgba(255, 255, 255, 0.7);">
                    Don't have an account? <a href="#" style="color: var(--primary); text-decoration: none; font-weight: 600;" onclick="showRegister()">Sign up</a>
                </div>
            </div>

            <!-- Register Form -->
            <div id="registerSection" class="hidden">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="logo-text">Create Account</div>
                </div>
                <form id="registerForm">
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-input" id="regUsername" placeholder="Choose a username" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="regPassword" placeholder="Create a password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Role</label>
                        <select class="form-input" id="regRole">
                            <option value="student">Student</option>
                            <option value="teacher">Teacher</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" id="registerBtn" style="width: 100%;">
                        <span>Create Account</span>
                    </button>
                </form>
                <div style="text-align: center; margin-top: 1.5rem; color: rgba(255, 255, 255, 0.7);">
                    Already have an account? <a href="#" style="color: var(--primary); text-decoration: none; font-weight: 600;" onclick="showLogin()">Sign in</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="container">
        <div class="dashboard" id="dashboard">
            <!-- Header -->
            <div class="header">
                <div class="logo" style="text-align: left; margin: 0;">
                    <div class="logo-text">EduSphere</div>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div>
                        <div id="userName">User</div>
                        <div id="userRole" style="opacity: 0.7; font-size: 0.9rem;">Role</div>
                    </div>
                    <button class="btn btn-secondary" onclick="logout()" style="width: auto; padding: 0.5rem 1rem;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Navigation -->
            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showSection('tests')">
                    <i class="fas fa-file-alt"></i> Mock Tests
                </div>
                <div class="nav-tab" onclick="showSection('createTest')">
                    <i class="fas fa-plus-circle"></i> Create Test
                </div>
                <div class="nav-tab" onclick="showSection('performance')">
                    <i class="fas fa-chart-line"></i> Performance
                </div>
                <div class="nav-tab" onclick="showSection('guidance')">
                    <i class="fas fa-robot"></i> AI Guidance
                </div>
                <div class="nav-tab hidden" id="adminTab" onclick="showSection('admin')">
                    <i class="fas fa-cogs"></i> Admin
                </div>
            </div>

            <!-- Content Sections -->
            <div class="content-section active" id="testsSection">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 class="card-title">Available Mock Tests</h2>
                        <button class="btn btn-secondary" onclick="refreshTests()" style="width: auto;">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div class="test-grid" id="testsGrid">
                        <!-- Test cards will be populated here -->
                    </div>
                </div>
            </div>

            <div class="content-section" id="createTestSection">
                <div class="card">
                    <h2 class="card-title">Create Custom Test</h2>
                    <div class="test-creation-form">
                        <div class="form-group">
                            <label class="form-label">Subject</label>
                            <select class="form-input" id="testSubject">
                                <option value="physics">Physics</option>
                                <option value="chemistry">Chemistry</option>
                                <option value="mathematics">Mathematics</option>
                                <option value="biology">Biology</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Chapter</label>
                            <input type="text" class="form-input" id="testChapter" placeholder="Enter chapter name">
                        </div>
                        <div class="form-group form-row">
                            <label class="form-label">Difficulty Level</label>
                            <div class="difficulty-selector">
                                <div class="difficulty-option selected" data-level="mixed" onclick="selectDifficulty('mixed')">
                                    Mixed
                                </div>
                                <div class="difficulty-option" data-level="easy" onclick="selectDifficulty('easy')">
                                    Easy
                                </div>
                                <div class="difficulty-option" data-level="medium" onclick="selectDifficulty('medium')">
                                    Medium
                                </div>
                                <div class="difficulty-option" data-level="hard" onclick="selectDifficulty('hard')">
                                    Hard
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Number of Questions</label>
                            <input type="number" class="form-input" id="questionCount" min="1" max="50" value="10">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Duration (minutes)</label>
                            <input type="number" class="form-input" id="testDuration" min="5" max="180" value="30">
                        </div>
                        <div class="form-group form-row">
                            <button class="btn btn-primary" onclick="generateCustomTest()" style="width: 100%;">
                                <i class="fas fa-magic"></i> Generate Test
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-section" id="performanceSection">
                <div class="card">
                    <h2 class="card-title">Your Performance</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalTests">0</div>
                            <div class="stat-label">Tests Taken</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgScore">0%</div>
                            <div class="stat-label">Average Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="bestScore">0%</div>
                            <div class="stat-label">Best Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalTime">0h</div>
                            <div class="stat-label">Time Spent</div>
                        </div>
                    </div>
                    <div class="performance-chart" id="performanceChart">
                        <!-- Performance chart will be rendered here -->
                    </div>
                </div>
            </div>

            <div class="content-section" id="guidanceSection">
                <div class="card">
                    <h2 class="card-title">AI Learning Guidance</h2>
                    <div class="form-group">
                        <input type="text" class="form-input" id="chapterInput" placeholder="Enter chapter/topic (e.g., Organic Chemistry, Calculus)">
                        <button class="btn btn-primary" onclick="getAIGuidance()" style="margin-top: 1rem; width: 100%;">
                            <i class="fas fa-magic"></i> Get AI Guidance
                        </button>
                    </div>
                    <div id="guidanceResult"></div>
                </div>
            </div>

            <div class="content-section" id="adminSection">
                <div class="card">
                    <h2 class="card-title">Admin Dashboard</h2>
                    <div id="adminContent">
                        <div class="form-group">
                            <button class="btn btn-primary" onclick="showQuestionManagement()">
                                <i class="fas fa-database"></i> Manage Question Bank
                            </button>
                            <button class="btn btn-secondary" onclick="showTestManagement()" style="margin-left: 1rem;">
                                <i class="fas fa-file-alt"></i> Manage Tests
                            </button>
                        </div>
                        <div id="questionManagement" class="hidden">
                            <h3 style="margin-bottom: 1rem;">Question Bank Management</h3>
                            <div class="test-creation-form">
                                <div class="form-group">
                                    <label class="form-label">Subject</label>
                                    <select class="form-input" id="questionSubject">
                                        <option value="physics">Physics</option>
                                        <option value="chemistry">Chemistry</option>
                                        <option value="mathematics">Mathematics</option>
                                        <option value="biology">Biology</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Chapter</label>
                                    <input type="text" class="form-input" id="questionChapter" placeholder="Enter chapter name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Difficulty</label>
                                    <select class="form-input" id="questionDifficulty">
                                        <option value="easy">Easy</option>
                                        <option value="medium">Medium</option>
                                        <option value="hard">Hard</option>
                                    </select>
                                </div>
                                <div class="form-group form-row">
                                    <label class="form-label">Question Text</label>
                                    <textarea class="form-input" id="questionText" rows="3" placeholder="Enter the question text"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Option A</label>
                                    <input type="text" class="form-input" id="optionA" placeholder="Option A">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Option B</label>
                                    <input type="text" class="form-input" id="optionB" placeholder="Option B">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Option C</label>
                                    <input type="text" class="form-input" id="optionC" placeholder="Option C">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Option D</label>
                                    <input type="text" class="form-input" id="optionD" placeholder="Option D">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Correct Answer</label>
                                    <select class="form-input" id="correctAnswer">
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </div>
                                <div class="form-group form-row">
                                    <button class="btn btn-primary" onclick="addQuestion()" style="width: 100%;">
                                        <i class="fas fa-plus"></i> Add Question
                                    </button>
                                </div>
                            </div>
                            <div class="question-list" id="questionList">
                                <!-- Questions will be listed here -->
                            </div>
                        </div>
                        <div id="testManagement" class="hidden">
                            <h3 style="margin-bottom: 1rem;">Test Management</h3>
                            <div id="adminTestsList">
                                <!-- Admin tests will be listed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Test Interface -->
    <div class="test-interface hidden" id="testInterface">
        <div class="container">
            <div class="test-header">
                <h2 id="testTitle">Mock Test</h2>
                <div class="test-timer" id="testTimer">30:00</div>
            </div>
            
            <div class="question-container">
                <div class="question-text" id="currentQuestionText">Question text will appear here</div>
                <div class="options-container" id="optionsContainer">
                    <!-- Options will be populated here -->
                </div>
            </div>
            
            <div class="test-navigation">
                <button class="btn btn-secondary" id="prevQuestion" onclick="previousQuestion()">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <div>
                    <span id="currentQuestionNumber">1</span> of <span id="totalQuestions">10</span>
                </div>
                <button class="btn btn-primary" id="nextQuestion" onclick="nextQuestion()">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            
            <div class="question-palette" id="questionPalette">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="submitTest()" style="width: auto; padding: 1rem 2rem;">
                    <i class="fas fa-paper-plane"></i> Submit Test
                </button>
            </div>
        </div>
    </div>

    <script>
        // Mock data for questions and tests
        const questionBank = {
            physics: {
                "Mechanics": {
                    easy: [
                        {
                            text: "What is the SI unit of force?",
                            optionA: "Newton",
                            optionB: "Joule",
                            optionC: "Watt",
                            optionD: "Pascal",
                            correctAnswer: "A"
                        },
                        {
                            text: "Which law states that every action has an equal and opposite reaction?",
                            optionA: "Newton's First Law",
                            optionB: "Newton's Second Law",
                            optionC: "Newton's Third Law",
                            optionD: "Law of Gravitation",
                            correctAnswer: "C"
                        }
                    ],
                    medium: [
                        {
                            text: "A car accelerates from 0 to 60 km/h in 10 seconds. What is its acceleration?",
                            optionA: "1.67 m/s²",
                            optionB: "2.78 m/s²",
                            optionC: "6 m/s²",
                            optionD: "10 m/s²",
                            correctAnswer: "A"
                        }
                    ],
                    hard: [
                        {
                            text: "A block of mass 2 kg is placed on a frictionless inclined plane at 30°. What is the acceleration of the block down the plane?",
                            optionA: "2.45 m/s²",
                            optionB: "4.9 m/s²",
                            optionC: "9.8 m/s²",
                            optionD: "19.6 m/s²",
                            correctAnswer: "B"
                        }
                    ]
                },
                "Electromagnetism": {
                    easy: [
                        {
                            text: "What is the unit of electric current?",
                            optionA: "Volt",
                            optionB: "Ampere",
                            optionC: "Ohm",
                            optionD: "Watt",
                            correctAnswer: "B"
                        }
                    ],
                    medium: [
                        {
                            text: "A wire carrying a current of 5A is placed in a magnetic field of 0.2T. If the length of the wire in the field is 0.5m, what is the force on the wire?",
                            optionA: "0.5 N",
                            optionB: "1.0 N",
                            optionC: "2.0 N",
                            optionD: "5.0 N",
                            correctAnswer: "A"
                        }
                    ],
                    hard: [
                        {
                            text: "A charged particle moves in a circular path of radius 0.1m in a magnetic field of 0.5T. If the speed of the particle is 10^6 m/s, what is the charge to mass ratio?",
                            optionA: "2×10^7 C/kg",
                            optionB: "5×10^7 C/kg",
                            optionC: "1×10^8 C/kg",
                            optionD: "2×10^8 C/kg",
                            correctAnswer: "D"
                        }
                    ]
                }
            },
            chemistry: {
                "Organic Chemistry": {
                    easy: [
                        {
                            text: "Which functional group is present in alcohols?",
                            optionA: "-COOH",
                            optionB: "-OH",
                            optionC: "-CHO",
                            optionD: "-NH2",
                            correctAnswer: "B"
                        }
                    ],
                    medium: [
                        {
                            text: "What is the IUPAC name of CH3-CH2-CH(OH)-CH3?",
                            optionA: "Butan-1-ol",
                            optionB: "Butan-2-ol",
                            optionC: "Pentan-2-ol",
                            optionD: "2-Methylpropan-1-ol",
                            correctAnswer: "B"
                        }
                    ],
                    hard: [
                        {
                            text: "In the Cannizzaro reaction, which compound is formed along with the alcohol?",
                            optionA: "Aldehyde",
                            optionB: "Ketone",
                            optionC: "Carboxylic acid",
                            optionD: "Ester",
                            correctAnswer: "C"
                        }
                    ]
                }
            },
            mathematics: {
                "Calculus": {
                    easy: [
                        {
                            text: "What is the derivative of x²?",
                            optionA: "x",
                            optionB: "2x",
                            optionC: "2",
                            optionD: "x²",
                            correctAnswer: "B"
                        }
                    ],
                    medium: [
                        {
                            text: "What is the integral of 1/x?",
                            optionA: "ln|x| + C",
                            optionB: "1/x² + C",
                            optionC: "x + C",
                            optionD: "x²/2 + C",
                            correctAnswer: "A"
                        }
                    ],
                    hard: [
                        {
                            text: "What is the limit of (sin x)/x as x approaches 0?",
                            optionA: "0",
                            optionB: "1",
                            optionC: "∞",
                            optionD: "Does not exist",
                            correctAnswer: "B"
                        }
                    ]
                }
            },
            biology: {
                "Genetics": {
                    easy: [
                        {
                            text: "Who is known as the father of genetics?",
                            optionA: "Charles Darwin",
                            optionB: "Gregor Mendel",
                            optionC: "Louis Pasteur",
                            optionD: "James Watson",
                            correctAnswer: "B"
                        }
                    ],
                    medium: [
                        {
                            text: "In a dihybrid cross, what is the phenotypic ratio in F2 generation?",
                            optionA: "3:1",
                            optionB: "1:2:1",
                            optionC: "9:3:3:1",
                            optionD: "1:1:1:1",
                            correctAnswer: "C"
                        }
                    ],
                    hard: [
                        {
                            text: "Which of the following is an example of codominance?",
                            optionA: "AB blood group",
                            optionB: "Skin color in humans",
                            optionC: "Sickle cell anemia",
                            optionD: "Height in plants",
                            correctAnswer: "A"
                        }
                    ]
                }
            }
        };

        // AI Guidance data
        const aiGuidanceData = {
            "organic chemistry": {
                topic: "Organic Chemistry Fundamentals",
                content: "Organic chemistry is the study of carbon-containing compounds. Key concepts to master include:<ul><li>Functional groups and their properties</li><li>Nomenclature rules for naming compounds</li><li>Reaction mechanisms and intermediates</li><li>Stereochemistry and isomerism</li><li>Important named reactions and their applications</li></ul>Focus on understanding reaction mechanisms rather than memorizing reactions. Practice converting between different structural representations.",
                resources: ["Klein's Organic Chemistry", "Clayden's Organic Chemistry", "NCERT Chemistry Part II"]
            },
            "calculus": {
                topic: "Calculus Essentials",
                content: "Calculus forms the foundation for many advanced mathematics and physics concepts. Key areas include:<ul><li>Limits and continuity</li><li>Differentiation rules and applications</li><li>Integration techniques and applications</li><li>Differential equations</li><li>Multivariable calculus basics</li></ul>Practice solving problems with real-world applications to build intuition. Focus on understanding the geometric interpretations of derivatives and integrals.",
                resources: ["Thomas' Calculus", "Stewart's Calculus", "Arihant's Differential Calculus"]
            },
            "mechanics": {
                topic: "Classical Mechanics",
                content: "Mechanics deals with the motion of objects and the forces that cause motion. Key topics include:<ul><li>Newton's laws of motion</li><li>Work, energy, and power</li><li>Rotational dynamics</li><li>Gravitation</li><li>Oscillations and waves</li></ul>Develop strong problem-solving skills by practicing free-body diagrams and applying conservation laws. Understand the vector nature of forces and motion.",
                resources: ["HC Verma's Concepts of Physics", "IE Irodov's Problems in Physics", "Resnick Halliday Fundamentals of Physics"]
            },
            "electromagnetism": {
                topic: "Electromagnetism",
                content: "Electromagnetism studies the relationship between electricity and magnetism. Key concepts include:<ul><li>Coulomb's law and electric fields</li><li>Gauss's law and applications</li><li>Capacitance and dielectrics</li><li>Magnetic fields and forces</li><li>Electromagnetic induction</li></ul>Focus on understanding field concepts and Maxwell's equations. Practice problems involving symmetry to apply Gauss's law effectively.",
                resources: ["Griffiths' Introduction to Electrodynamics", "NCERT Physics Part I", "DC Pandey's Electricity and Magnetism"]
            },
            "genetics": {
                topic: "Genetics and Molecular Biology",
                content: "Genetics explores inheritance and variation in organisms. Key areas include:<ul><li>Mendelian inheritance patterns</li><li>Chromosome theory of inheritance</li><li>DNA structure and replication</li><li>Gene expression and regulation</li><li>Genetic engineering techniques</li></ul>Practice solving pedigree analysis problems and understanding molecular biology techniques. Focus on the central dogma of molecular biology.",
                resources: ["NCERT Biology Class XII", "Principles of Genetics by Gardner", "Molecular Biology of the Gene by Watson"]
            }
        };

        const API_BASE_URL = 'https://eduspherebackend-0ytt.onrender.com';
        let currentUser = null;
        let currentTest = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let testTimer = null;
        let timeRemaining = 0;
        let userPerformance = JSON.parse(localStorage.getItem('userPerformance')) || {
            testsTaken: 0,
            averageScore: 0,
            bestScore: 0,
            totalTime: 0,
            testHistory: []
        };

        // Enhanced API call function with better error handling
        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            
            const config = {
                ...options,
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers,
                },
            };

            try {
                console.log(`Making API call to: ${url}`);
                const response = await fetch(url, config);
                
                // Check if response is HTML (error page) instead of JSON
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('text/html')) {
                    throw new Error('Server returned HTML instead of JSON. Check CORS configuration.');
                }
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                // For demo purposes, we'll use mock data when API fails
                return getMockData(endpoint, options);
            }
        }

        // Mock data fallback
        function getMockData(endpoint, options) {
            console.log('Using mock data for:', endpoint);
            
            if (endpoint === '/api/tests' && options.method === 'GET') {
                return Promise.resolve([
                    {
                        _id: '1',
                        title: 'Physics - Mechanics Full Test',
                        description: 'Complete test covering Newton\'s Laws, Kinematics, and Dynamics',
                        subject: 'physics',
                        duration: 60,
                        questions: questionBank.physics.Mechanics.easy.concat(
                            questionBank.physics.Mechanics.medium,
                            questionBank.physics.Mechanics.hard
                        )
                    },
                    {
                        _id: '2',
                        title: 'Chemistry - Organic Chemistry',
                        description: 'Test on functional groups, nomenclature and reactions',
                        subject: 'chemistry',
                        duration: 45,
                        questions: questionBank.chemistry['Organic Chemistry'].easy.concat(
                            questionBank.chemistry['Organic Chemistry'].medium,
                            questionBank.chemistry['Organic Chemistry'].hard
                        )
                    }
                ]);
            }
            
            if (endpoint === '/api/user') {
                return Promise.resolve({ user: null });
            }
            
            if (endpoint === '/api/login' && options.method === 'POST') {
                const body = JSON.parse(options.body);
                return Promise.resolve({ 
                    user: { 
                        username: body.username, 
                        role: body.role || 'student',
                        id: 'mock-user-123'
                    } 
                });
            }
            
            if (endpoint === '/api/register' && options.method === 'POST') {
                return Promise.resolve({ success: true });
            }
            
            if (endpoint.startsWith('/api/tests/') && endpoint.endsWith('/submit') && options.method === 'POST') {
                const body = JSON.parse(options.body);
                const score = calculateScore(body.answers, currentTest.questions);
                return Promise.resolve({ score, total: currentTest.questions.length });
            }
            
            return Promise.resolve({});
        }

        // Check authentication
        async function checkAuth() {
            try {
                const data = await apiCall('/api/user');
                if (data.user) {
                    currentUser = data.user;
                    showDashboard();
                }
            } catch (error) {
                console.log('Not authenticated or server error:', error.message);
            }
        }

        // Login function
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;

            const loginBtn = document.getElementById('loginBtn');
            loginBtn.innerHTML = '<div class="loading"></div>';

            try {
                const data = await apiCall('/api/login', {
                    method: 'POST',
                    body: JSON.stringify({ username, password, role })
                });

                if (data.user) {
                    currentUser = data.user;
                    showDashboard();
                } else {
                    alert(data.error || 'Login failed');
                }
            } catch (error) {
                alert('Login failed. Please check your credentials and try again.');
            } finally {
                loginBtn.innerHTML = '<span>Sign In</span>';
            }
        });

        // Register function
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;
            const role = document.getElementById('regRole').value;

            const registerBtn = document.getElementById('registerBtn');
            registerBtn.innerHTML = '<div class="loading"></div>';

            try {
                const data = await apiCall('/api/register', {
                    method: 'POST',
                    body: JSON.stringify({ username, password, role })
                });

                alert('Registration successful! Please login.');
                showLogin();
            } catch (error) {
                alert('Registration failed. Username may already exist.');
            } finally {
                registerBtn.innerHTML = '<span>Create Account</span>';
            }
        });

        function showLogin() {
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('registerSection').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('registerSection').classList.remove('hidden');
        }

        function showDashboard() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            document.getElementById('userName').textContent = currentUser.username;
            document.getElementById('userRole').textContent = currentUser.role;
            document.getElementById('userAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
            
            if (currentUser.role === 'admin') {
                document.getElementById('adminTab').classList.remove('hidden');
            }
            
            loadTests();
            loadQuestions();
            updatePerformanceStats();
        }

        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionName + 'Section').classList.add('active');
            event.target.classList.add('active');
            
            if (sectionName === 'admin') {
                loadAdminData();
            } else if (sectionName === 'performance') {
                updatePerformanceStats();
            }
        }

        function selectDifficulty(level) {
            document.querySelectorAll('.difficulty-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`.difficulty-option[data-level="${level}"]`).classList.add('selected');
        }

        async function loadTests() {
            try {
                const tests = await apiCall('/api/tests');
                const testsGrid = document.getElementById('testsGrid');
                
                if (tests.length === 0) {
                    testsGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; opacity: 0.7;">
                            <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <p>No tests available yet. Check back later or create your own custom test.</p>
                        </div>
                    `;
                    return;
                }
                
                testsGrid.innerHTML = tests.map(test => `
                    <div class="test-card" onclick="startTest('${test._id}')">
                        <div class="test-badge">${test.duration} min</div>
                        <h3>${test.title}</h3>
                        <p style="opacity: 0.8; margin: 1rem 0;">${test.description}</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="background: var(--primary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">${test.subject}</span>
                            <span style="opacity: 0.7;">${test.questions?.length || 0} questions</span>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load tests:', error);
                document.getElementById('testsGrid').innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: var(--danger);">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Failed to load tests. Please try again later.</p>
                    </div>
                `;
            }
        }

        function generateCustomTest() {
            const subject = document.getElementById('testSubject').value;
            const chapter = document.getElementById('testChapter').value;
            const difficulty = document.querySelector('.difficulty-option.selected')?.dataset.level || 'mixed';
            const questionCount = parseInt(document.getElementById('questionCount').value);
            const duration = parseInt(document.getElementById('testDuration').value);
            
            if (!chapter) {
                alert('Please enter a chapter name');
                return;
            }
            
            // Generate test from question bank
            const questions = getQuestionsByCriteria(subject, chapter, difficulty, questionCount);
            
            if (questions.length === 0) {
                alert('No questions found for the selected criteria. Try a different chapter or subject.');
                return;
            }
            
            currentTest = {
                _id: 'custom-' + Date.now(),
                title: `${subject.charAt(0).toUpperCase() + subject.slice(1)} - ${chapter} (${difficulty})`,
                description: `Custom test on ${chapter} with ${difficulty} difficulty`,
                subject: subject,
                duration: duration,
                questions: questions
            };
            
            startTest(currentTest._id);
        }

        function getQuestionsByCriteria(subject, chapter, difficulty, count) {
            if (!questionBank[subject] || !questionBank[subject][chapter]) {
                return [];
            }
            
            const chapterQuestions = questionBank[subject][chapter];
            let questions = [];
            
            if (difficulty === 'mixed') {
                // Mix questions from all difficulty levels
                questions = [
                    ...chapterQuestions.easy || [],
                    ...chapterQuestions.medium || [],
                    ...chapterQuestions.hard || []
                ];
            } else {
                questions = chapterQuestions[difficulty] || [];
            }
            
            // Shuffle and select required number of questions
            return shuffleArray(questions).slice(0, count);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        async function startTest(testId) {
            try {
                let test;
                if (testId.startsWith('custom-')) {
                    test = currentTest;
                } else {
                    const tests = await apiCall('/api/tests');
                    test = tests.find(t => t._id === testId);
                }
                
                if (!test) {
                    alert('Test not found');
                    return;
                }
                
                currentTest = test;
                currentQuestionIndex = 0;
                userAnswers = new Array(test.questions.length).fill(null);
                timeRemaining = test.duration * 60; // Convert to seconds
                
                document.getElementById('testTitle').textContent = test.title;
                document.getElementById('totalQuestions').textContent = test.questions.length;
                
                showTestInterface();
                displayQuestion(0);
                startTimer();
                
                // Create question palette
                const palette = document.getElementById('questionPalette');
                palette.innerHTML = '';
                for (let i = 0; i < test.questions.length; i++) {
                    const paletteItem = document.createElement('div');
                    paletteItem.className = 'palette-item';
                    paletteItem.textContent = i + 1;
                    paletteItem.onclick = () => displayQuestion(i);
                    palette.appendChild(paletteItem);
                }
            } catch (error) {
                console.error('Failed to start test:', error);
                alert('Failed to load test. Please try again.');
            }
        }

        function showTestInterface() {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('testInterface').classList.remove('hidden');
        }

        function hideTestInterface() {
            document.getElementById('testInterface').classList.add('hidden');
            document.getElementById('dashboard').style.display = 'block';
        }

        function displayQuestion(index) {
            if (!currentTest || !currentTest.questions || index < 0 || index >= currentTest.questions.length) {
                return;
            }
            
            currentQuestionIndex = index;
            const question = currentTest.questions[index];
            
            document.getElementById('currentQuestionNumber').textContent = index + 1;
            document.getElementById('currentQuestionText').textContent = question.text;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            ['A', 'B', 'C', 'D'].forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = `option ${userAnswers[index] === option ? 'selected' : ''}`;
                optionElement.textContent = `${option}. ${question[`option${option}`]}`;
                optionElement.onclick = () => selectAnswer(option);
                optionsContainer.appendChild(optionElement);
            });
            
            // Update question palette
            document.querySelectorAll('.palette-item').forEach((item, i) => {
                item.classList.remove('current');
                if (userAnswers[i] !== null) {
                    item.classList.add('answered');
                }
            });
            document.querySelectorAll('.palette-item')[index].classList.add('current');
            
            // Update navigation buttons
            document.getElementById('prevQuestion').disabled = index === 0;
            document.getElementById('nextQuestion').disabled = index === currentTest.questions.length - 1;
        }

        function selectAnswer(option) {
            userAnswers[currentQuestionIndex] = option;
            displayQuestion(currentQuestionIndex); // Refresh to show selection
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentTest.questions.length - 1) {
                displayQuestion(currentQuestionIndex + 1);
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                displayQuestion(currentQuestionIndex - 1);
            }
        }

        function startTimer() {
            updateTimerDisplay();
            
            testTimer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    submitTest();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('testTimer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function calculateScore(answers, questions) {
            let correct = 0;
            answers.forEach((answer, index) => {
                if (answer === questions[index].correctAnswer) {
                    correct++;
                }
            });
            return correct;
        }

        async function submitTest() {
            if (testTimer) {
                clearInterval(testTimer);
            }
            
            try {
                const score = calculateScore(userAnswers, currentTest.questions);
                const total = currentTest.questions.length;
                const percentage = Math.round((score / total) * 100);
                
                // Update performance data
                userPerformance.testsTaken++;
                userPerformance.totalTime += currentTest.duration;
                
                if (percentage > userPerformance.bestScore) {
                    userPerformance.bestScore = percentage;
                }
                
                // Calculate new average
                const totalScore = userPerformance.averageScore * (userPerformance.testsTaken - 1) + percentage;
                userPerformance.averageScore = Math.round(totalScore / userPerformance.testsTaken);
                
                // Add to test history
                userPerformance.testHistory.push({
                    testId: currentTest._id,
                    testName: currentTest.title,
                    score: percentage,
                    date: new Date().toISOString(),
                    duration: currentTest.duration
                });
                
                // Save to localStorage
                localStorage.setItem('userPerformance', JSON.stringify(userPerformance));
                
                alert(`Test submitted! Your score: ${score}/${total} (${percentage}%)`);
                hideTestInterface();
                loadTests();
                updatePerformanceStats();
            } catch (error) {
                console.error('Failed to submit test:', error);
                alert('Failed to submit test. Please try again.');
            }
        }

        function updatePerformanceStats() {
            document.getElementById('totalTests').textContent = userPerformance.testsTaken;
            document.getElementById('avgScore').textContent = userPerformance.averageScore + '%';
            document.getElementById('bestScore').textContent = userPerformance.bestScore + '%';
            document.getElementById('totalTime').textContent = Math.round(userPerformance.totalTime / 60) + 'h';
            
            // Update performance chart
            renderPerformanceChart();
        }

        function renderPerformanceChart() {
            const chart = document.getElementById('performanceChart');
            chart.innerHTML = '';
            
            if (userPerformance.testHistory.length === 0) {
                chart.innerHTML = '<p style="text-align: center; padding: 2rem; opacity: 0.7;">No test data available yet</p>';
                return;
            }
            
            // Show last 5 tests
            const recentTests = userPerformance.testHistory.slice(-5);
            const maxScore = Math.max(...recentTests.map(t => t.score), 100);
            
            recentTests.forEach((test, index) => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = `${(test.score / maxScore) * 100}%`;
                bar.title = `${test.testName}: ${test.score}%`;
                
                const label = document.createElement('div');
                label.className = 'chart-label';
                label.textContent = `Test ${index + 1}`;
                
                bar.appendChild(label);
                chart.appendChild(bar);
            });
        }

        async function getAIGuidance() {
            const chapter = document.getElementById('chapterInput').value.toLowerCase();
            if (!chapter) {
                alert('Please enter a chapter or topic');
                return;
            }
            
            const guidanceResult = document.getElementById('guidanceResult');
            guidanceResult.innerHTML = '<div class="loading" style="margin: 2rem auto;"></div>';
            
            try {
                // Try to get AI guidance from API
                const response = await apiCall('/api/ai-guidance', {
                    method: 'POST',
                    body: JSON.stringify({ topic: chapter })
                });
                
                if (response.guidance) {
                    displayGuidance(response);
                } else {
                    // Fallback to mock data
                    displayMockGuidance(chapter);
                }
            } catch (error) {
                console.error('Failed to get AI guidance:', error);
                // Fallback to mock data
                displayMockGuidance(chapter);
            }
        }

        function displayMockGuidance(chapter) {
            const guidanceResult = document.getElementById('guidanceResult');
            
            // Find the best matching topic
            let matchedTopic = null;
            for (const topic in aiGuidanceData) {
                if (chapter.includes(topic) || topic.includes(chapter)) {
                    matchedTopic = aiGuidanceData[topic];
                    break;
                }
            }
            
            if (!matchedTopic) {
                // Use a default guidance
                matchedTopic = {
                    topic: chapter.charAt(0).toUpperCase() + chapter.slice(1),
                    content: `For ${chapter}, focus on understanding the fundamental concepts first. Practice regularly with problems of varying difficulty levels. Create summary notes of key formulas and concepts. Review your mistakes to identify patterns and areas needing improvement.`,
                    resources: ["NCERT Textbook", "Reference books specific to your exam", "Online video lectures"]
                };
            }
            
            displayGuidance(matchedTopic);
        }

        function displayGuidance(guidance) {
            const guidanceResult = document.getElementById('guidanceResult');
            
            guidanceResult.innerHTML = `
                <div class="guidance-result">
                    <div class="guidance-topic">${guidance.topic}</div>
                    <div class="guidance-content">
                        ${guidance.content}
                        <p><strong>Recommended Resources:</strong> ${guidance.resources?.join(', ') || 'NCERT, Reference books, Online materials'}</p>
                    </div>
                </div>
            `;
        }

        function showQuestionManagement() {
            document.getElementById('questionManagement').classList.remove('hidden');
            document.getElementById('testManagement').classList.add('hidden');
        }

        function showTestManagement() {
            document.getElementById('questionManagement').classList.add('hidden');
            document.getElementById('testManagement').classList.remove('hidden');
            loadAdminTests();
        }

        async function loadQuestions() {
            try {
                const questions = await apiCall('/api/questions');
                const questionList = document.getElementById('questionList');
                
                if (questions.length === 0) {
                    questionList.innerHTML = '<p style="opacity: 0.7; text-align: center; padding: 2rem;">No questions in the database yet.</p>';
                    return;
                }
                
                questionList.innerHTML = questions.map(q => `
                    <div class="question-item">
                        <div class="question-text">${q.text}</div>
                        <div class="question-difficulty difficulty-${q.difficulty}">${q.difficulty}</div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load questions:', error);
                // Show mock questions for demo
                const questionList = document.getElementById('questionList');
                questionList.innerHTML = `
                    <div class="question-item">
                        <div class="question-text">What is the SI unit of force?</div>
                        <div class="question-difficulty difficulty-easy">easy</div>
                    </div>
                    <div class="question-item">
                        <div class="question-text">A car accelerates from 0 to 60 km/h in 10 seconds. What is its acceleration?</div>
                        <div class="question-difficulty difficulty-medium">medium</div>
                    </div>
                    <div class="question-item">
                        <div class="question-text">A block of mass 2 kg is placed on a frictionless inclined plane at 30°. What is the acceleration of the block down the plane?</div>
                        <div class="question-difficulty difficulty-hard">hard</div>
                    </div>
                `;
            }
        }

        async function addQuestion() {
            const subject = document.getElementById('questionSubject').value;
            const chapter = document.getElementById('questionChapter').value;
            const difficulty = document.getElementById('questionDifficulty').value;
            const text = document.getElementById('questionText').value;
            const optionA = document.getElementById('optionA').value;
            const optionB = document.getElementById('optionB').value;
            const optionC = document.getElementById('optionC').value;
            const optionD = document.getElementById('optionD').value;
            const correctAnswer = document.getElementById('correctAnswer').value;
            
            if (!text || !chapter || !optionA || !optionB || !optionC || !optionD) {
                alert('Please fill all fields');
                return;
            }
            
            try {
                await apiCall('/api/questions', {
                    method: 'POST',
                    body: JSON.stringify({
                        subject,
                        chapter,
                        difficulty,
                        text,
                        optionA,
                        optionB,
                        optionC,
                        optionD,
                        correctAnswer
                    })
                });
                
                alert('Question added successfully!');
                loadQuestions();
                
                // Clear form
                document.getElementById('questionText').value = '';
                document.getElementById('optionA').value = '';
                document.getElementById('optionB').value = '';
                document.getElementById('optionC').value = '';
                document.getElementById('optionD').value = '';
            } catch (error) {
                console.error('Failed to add question:', error);
                alert('Question added to local storage (demo mode)');
                loadQuestions();
            }
        }

        async function loadAdminTests() {
            try {
                const tests = await apiCall('/api/tests');
                const adminTestsList = document.getElementById('adminTestsList');
                
                if (tests.length === 0) {
                    adminTestsList.innerHTML = '<p style="opacity: 0.7; text-align: center; padding: 2rem;">No tests available.</p>';
                    return;
                }
                
                adminTestsList.innerHTML = tests.map(test => `
                    <div class="test-card">
                        <h3>${test.title}</h3>
                        <p style="opacity: 0.8; margin: 1rem 0;">${test.description}</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="background: var(--primary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">${test.subject}</span>
                            <span style="opacity: 0.7;">${test.questions?.length || 0} questions</span>
                        </div>
                        <div style="margin-top: 1rem;">
                            <button class="btn btn-secondary" onclick="deleteTest('${test._id}')" style="width: auto; padding: 0.5rem 1rem;">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load admin tests:', error);
            }
        }

        async function deleteTest(testId) {
            if (!confirm('Are you sure you want to delete this test?')) {
                return;
            }
            
            try {
                await apiCall(`/api/tests/${testId}`, {
                    method: 'DELETE'
                });
                
                alert('Test deleted successfully!');
                loadAdminTests();
            } catch (error) {
                console.error('Failed to delete test:', error);
                alert('Test deleted from local storage (demo mode)');
                loadAdminTests();
            }
        }

        function loadAdminData() {
            loadQuestions();
            loadAdminTests();
        }

        function refreshTests() {
            loadTests();
        }

        function logout() {
            currentUser = null;
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('loginForm').reset();
            document.getElementById('registerForm').reset();
        }

        // Initialize the app
        checkAuth();
    </script>
</body>
</html>